---
/**
 * ProductCard.astro
 */

const {
  imageSrc,
  imageAlt = "Product image",
  name,
  description,
  price,
  originalPrice = null,
  discount = null,
  rating = 4.5,
  ratingCount = 0,
  buttonColor = "bg-gray-900",          // default
  buttonHoverColor = "bg-gray-750",     // default
} = Astro.props;

// Map dynamic color to full static class (Tailwind-safe)
const bgClass = `bg-${buttonColor}`;
const hoverBgClass = `hover:bg-${buttonHoverColor}`;

// Star rendering logic (simple version)
const fullStars = Math.floor(rating);
const hasHalf = rating % 1 >= 0.5;
const emptyStars = 5 - fullStars - (hasHalf ? 1 : 0);
---

<div class="
  group relative
  bg-[#fffef7] rounded-xl sm:rounded-2xl
  overflow-hidden shadow-sm hover:shadow-lg sm:hover:shadow-xl
  transition-all duration-300 flex flex-col h-full
  border border-gray-100/80 text-center
  min-w-[150px] max-w-[320px] xs:max-w-none
">

  <!-- Image -->
  <div class="relative w-full aspect-[4/3] xs:aspect-square overflow-hidden bg-gray-50">
    <img
      src={imageSrc}
      alt={imageAlt}
      class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 sm:group-hover:scale-110 transition-transform duration-500"
      loading="lazy"
      decoding="async"
    />
  </div>

  <!-- Content -->
  <div class="p-4 xs:p-5 sm:p-6 flex flex-col flex-grow">
    <h3 class="
      font-bold leading-tight
      text-sm xs:text-base sm:text-lg md:text-xl
      mb-2 text-gray-900 line-clamp-2
    ">
      {name}
    </h3>

    <p class="
      text-xs sm:text-sm text-gray-600
      mb-3 sm:mb-4 line-clamp-2
    ">
      {description}
    </p>

    <div class="flex items-center justify-center gap-1 text-yellow-500 text-base sm:text-lg mb-2">
      {'★'.repeat(fullStars)}{hasHalf ? '½' : ''}{'☆'.repeat(emptyStars)}
      <span class="text-gray-400 text-xs sm:text-sm ml-2">({ratingCount})</span>
    </div>

    <a href="#" class="text-xs sm:text-sm text-blue-600 hover:text-blue-800 hover:underline mb-3">
      Rate this product
    </a>

    <div class="flex items-center justify-center gap-2 sm:gap-3 mb-4">
      <span class="text-2xl sm:text-3xl font-extrabold text-gray-900">
        ${price}
      </span>

      {originalPrice && (
        <div class="flex items-center gap-2">
          <span class="text-sm sm:text-base text-red-600 line-through opacity-70">
            ${originalPrice}
          </span>
          {discount && (
            <span class="text-sm sm:text-base font-bold text-red-600">
              {discount}
            </span>
          )}
        </div>
      )}
    </div>

    <!-- ADD TO CART – using safelisted static classes -->
    <button class={`
      mt-auto w-full
      ${bgClass} ${hoverBgClass}
      text-white font-bold
      bg-gray-900 hover:bg-gray-750
      py-3 sm:py-4
      px-5 sm:px-6
      rounded-xl
      shadow-md hover:shadow-lg
      transition-all duration-300
      uppercase text-sm sm:text-base tracking-wide
      active:scale-98 touch-manipulation
    `}>
      COMING SOON
    </button>
  </div>
</div>